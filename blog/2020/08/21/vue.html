<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>iview · 柳小白</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="### 动态组件"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="iview · 柳小白"/><meta property="og:type" content="website"/><meta property="og:url" content="https://github.com/stupidWall/liuxiaobai/liuxiaobai/blog/2020/08/21/vue"/><meta property="og:description" content="### 动态组件"/><meta property="og:image" content="https://github.com/stupidWall/liuxiaobai/liuxiaobai/img/1.jpeg"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://github.com/stupidWall/liuxiaobai/liuxiaobai/img/1.jpeg"/><link rel="shortcut icon" href="/liuxiaobai/"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/tomorrow-night.min.css"/><link rel="alternate" type="application/atom+xml" href="https://github.com/stupidWall/liuxiaobai/liuxiaobai/blog/atom.xml" title="柳小白 Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://github.com/stupidWall/liuxiaobai/liuxiaobai/blog/feed.xml" title="柳小白 Blog RSS Feed"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="/liuxiaobai/js/scrollSpy.js"></script><link rel="stylesheet" href="/liuxiaobai/css/main.css"/><script src="/liuxiaobai/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/liuxiaobai/"><h2 class="headerTitle">柳小白</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/liuxiaobai/blog/" target="_self">Blog</a></li><li class=""><a href="https://github.com/stupidWall/liuxiaobai" target="_self">GitHub</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>All Blog Posts</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">All Blog Posts</h3><ul class=""><li class="navListItem navListItemActive"><a class="navItem" href="/liuxiaobai/blog/2020/08/21/vue">iview</a></li><li class="navListItem"><a class="navItem" href="/liuxiaobai/blog/2020/08/15/对象转内联样式">对象转内联样式</a></li><li class="navListItem"><a class="navItem" href="/liuxiaobai/blog/2019/10/23/SSR">服务端渲染SSR</a></li><li class="navListItem"><a class="navItem" href="/liuxiaobai/blog/2019/10/11/vue双向绑定">vue双向绑定原理</a></li><li class="navListItem"><a class="navItem" href="/liuxiaobai/blog/2019/10/08/vuex">实现一个简单的vuex</a></li><li class="navListItem"><a class="navItem" href="/liuxiaobai/blog/2019/09/30/vue-router">实现一个简单的vue-router</a></li><li class="navListItem"><a class="navItem" href="/liuxiaobai/blog/2019/09/16/tree2">二叉树</a></li><li class="navListItem"><a class="navItem" href="/liuxiaobai/blog/2019/09/08/linklist">实现链表并应用</a></li><li class="navListItem"><a class="navItem" href="/liuxiaobai/blog/2019/09/05/stack">实现栈并应用</a></li><li class="navListItem"><a class="navItem" href="/liuxiaobai/blog/2019/09/05/queue">实现队列并应用</a></li><li class="navListItem"><a class="navItem" href="/liuxiaobai/blog/2019/08/27/jsonp">实现一个JSONP</a></li><li class="navListItem"><a class="navItem" href="/liuxiaobai/blog/2019/10/13.vue源码">vue源码</a></li><li class="navListItem"><a class="navItem" href="/liuxiaobai/blog/2019/08/26/柯里化">柯里化</a></li><li class="navListItem"><a class="navItem" href="/liuxiaobai/blog/2019/08/26/实现一个Promise">实现一个Promise</a></li><li class="navListItem"><a class="navItem" href="/liuxiaobai/blog/2019/08/26/实现instanceof">实现一个instanceof</a></li><li class="navListItem"><a class="navItem" href="/liuxiaobai/blog/2019/08/14/Object.assign">模拟实现Object.assign</a></li><li class="navListItem"><a class="navItem" href="/liuxiaobai/blog/2019/07/14/TypeScript">TypeScript</a></li><li class="navListItem"><a class="navItem" href="/liuxiaobai/blog/2019/07/12/utils">收集开源项目好用工具函数</a></li><li class="navListItem"><a class="navItem" href="/liuxiaobai/blog/2019/07/12/TaroUi">taro-ui</a></li><li class="navListItem"><a class="navItem" href="/liuxiaobai/blog/2019/07/11/events">读Taro消息机制源码笔记</a></li><li class="navListItem"><a class="navItem" href="/liuxiaobai/blog/2019/07/10/面试题">火爆了的前端面试题</a></li><li class="navListItem"><a class="navItem" href="/liuxiaobai/blog/2019/07/06/泛型">泛型（TypeScript学习笔记）</a></li><li class="navListItem"><a class="navItem" href="/liuxiaobai/blog/2019/07/06/格式化日期">格式化日期</a></li><li class="navListItem"><a class="navItem" href="/liuxiaobai/blog/2019/07/06/枚举">枚举（TypeScript学习笔记）</a></li><li class="navListItem"><a class="navItem" href="/liuxiaobai/blog/2019/07/06/react生命周期">React生命周期</a></li><li class="navListItem"><a class="navItem" href="/liuxiaobai/blog/2019/07/06/parseStyle">内联样式转对象</a></li><li class="navListItem"><a class="navItem" href="/liuxiaobai/blog/2019/07/05/驼峰">中横线转驼峰变量</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer postContainer blogContainer"><div class="wrapper"><div class="lonePost"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle"><a href="/liuxiaobai/blog/2020/08/21/vue">iview</a></h1><p class="post-meta">August 21, 2020</p><div class="authorBlock"><p class="post-authorName"><a href="" target="_blank" rel="noreferrer noopener">六小白</a></p></div></header><div><span><h3><a class="anchor" aria-hidden="true" id="动态组件"></a><a href="#动态组件" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>动态组件</h3>
<pre><code class="hljs css language-javascript">&lt;component :is=<span class="hljs-string">"wrapperComponent"</span>&gt;
<span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">component</span>&gt;</span></span>

...

computed: {
  wrapperComponent() {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.affix ? <span class="hljs-string">'Affix'</span> : <span class="hljs-string">'div'</span>;
  }
}
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="匹配锚点"></a><a href="#匹配锚点" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>匹配锚点</h3>
<pre><code class="hljs css language-javascript"><span class="hljs-keyword">var</span> reg =  <span class="hljs-regexp">/#([^#]+)$/</span>
<span class="hljs-keyword">var</span> match = reg.exec(<span class="hljs-string">'https://www.iviewui.com/components/anchor#AnchorLink_props'</span>)

<span class="hljs-comment">// match</span>
[
  <span class="hljs-string">'#AnchorLink_props'</span>,
  <span class="hljs-string">'AnchorLink_props'</span>,
  ...
]
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="节点元素滚动动画"></a><a href="#节点元素滚动动画" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>节点元素滚动动画</h3>
<pre><code class="hljs css language-javascript"><span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">scrollTop</span>(<span class="hljs-params">el, from = <span class="hljs-number">0</span>, to, duration = <span class="hljs-number">500</span>, endCallback</span>) </span>{
    <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">window</span>.requestAnimationFrame) {
        <span class="hljs-built_in">window</span>.requestAnimationFrame = (
            <span class="hljs-built_in">window</span>.webkitRequestAnimationFrame ||
            <span class="hljs-built_in">window</span>.mozRequestAnimationFrame ||
            <span class="hljs-built_in">window</span>.msRequestAnimationFrame ||
            <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">callback</span>) </span>{
                <span class="hljs-keyword">return</span> <span class="hljs-built_in">window</span>.setTimeout(callback, <span class="hljs-number">1000</span>/<span class="hljs-number">60</span>);
            }
        );
    }
    <span class="hljs-keyword">const</span> difference = <span class="hljs-built_in">Math</span>.abs(<span class="hljs-keyword">from</span> - to);
    <span class="hljs-keyword">const</span> step = <span class="hljs-built_in">Math</span>.ceil(difference / duration * <span class="hljs-number">50</span>);

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">scroll</span>(<span class="hljs-params">start, end, step</span>) </span>{
        <span class="hljs-keyword">if</span> (start === end) {
            endCallback &amp;&amp; endCallback();
            <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-keyword">let</span> d = (start + step &gt; end) ? end : start + step;
        <span class="hljs-keyword">if</span> (start &gt; end) {
            d = (start - step &lt; end) ? end : start - step;
        }

        <span class="hljs-keyword">if</span> (el === <span class="hljs-built_in">window</span>) {
            <span class="hljs-built_in">window</span>.scrollTo(d, d);
        } <span class="hljs-keyword">else</span> {
            el.scrollTop = d;
        }
        <span class="hljs-built_in">window</span>.requestAnimationFrame(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> scroll(d, end, step));
    }
    scroll(<span class="hljs-keyword">from</span>, to, step);
}
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="组件通信"></a><a href="#组件通信" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>组件通信</h3>
<pre><code class="hljs css language-javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">broadcast</span>(<span class="hljs-params">componentName, eventName, params</span>) </span>{
    <span class="hljs-keyword">this</span>.$children.forEach(<span class="hljs-function"><span class="hljs-params">child</span> =&gt;</span> {
        <span class="hljs-keyword">const</span> name = child.$options.name;

        <span class="hljs-keyword">if</span> (name === componentName) {
            child.$emit.apply(child, [eventName].concat(params));
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// todo 如果 params 是空数组，接收到的会是 undefined</span>
            broadcast.apply(child, [componentName, eventName].concat([params]));
        }
    });
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
    <span class="hljs-attr">methods</span>: {
        dispatch(componentName, eventName, params) {
            <span class="hljs-keyword">let</span> parent = <span class="hljs-keyword">this</span>.$parent || <span class="hljs-keyword">this</span>.$root;
            <span class="hljs-keyword">let</span> name = parent.$options.name;

            <span class="hljs-keyword">while</span> (parent &amp;&amp; (!name || name !== componentName)) {
                parent = parent.$parent;

                <span class="hljs-keyword">if</span> (parent) {
                    name = parent.$options.name;
                }
            }
            <span class="hljs-keyword">if</span> (parent) {
                parent.$emit.apply(parent, [eventName].concat(params));
            }
        },
        broadcast(componentName, eventName, params) {
            broadcast.call(<span class="hljs-keyword">this</span>, componentName, eventName, params);
        }
    }
};
</code></pre>
<p>使用</p>
<pre><code class="hljs css language-javascript">mixins: [ Emitter ]
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="父组件-子组件通信"></a><a href="#父组件-子组件通信" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>父组件 =&gt; 子组件通信</h3>
<ul>
<li><p>属性<code>$props</code></p></li>
<li><p>特性 <code>$attrs</code></p></li>
</ul>
<pre><code class="hljs"><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Child</span> <span class="hljs-attr">msg</span>=<span class="hljs-string">"hello"</span>/&gt;</span>


Child中未在props中声明msg, 即可这样访问：

<span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><span class="hljs-template-variable">{{$attrs.msg}}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</span></code></pre>
<h3><a class="anchor" aria-hidden="true" id="refs-通信"></a><a href="#refs-通信" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>$refs 通信</h3>
<pre><code class="hljs"><span class="hljs-keyword">this</span>.$<span class="hljs-built_in">ref</span>s.xx

<span class="hljs-keyword">this</span>.$children[<span class="hljs-number">0</span>]
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="子组件-父组件通信"></a><a href="#子组件-父组件通信" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>子组件 =&gt; 父组件通信</h3>
<p>事件</p>
<pre><code class="hljs">&lt;<span class="hljs-selector-tag">p</span> @click=<span class="hljs-string">"do"</span>&gt;&lt;/p&gt;

<span class="hljs-function"><span class="hljs-title">do</span><span class="hljs-params">()</span></span> {
    this.<span class="hljs-variable">$emit</span>(<span class="hljs-string">'on-do'</span>, null)
}
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="兄弟节点-通信"></a><a href="#兄弟节点-通信" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>兄弟节点 通信</h3>
<p>共同祖辈搭桥组件通信, <code>$parent</code>或<code>$root</code></p>
<pre><code class="hljs"><span class="hljs-comment">// border1</span>
<span class="hljs-keyword">this</span>.$<span class="hljs-built_in">parent</span>.$<span class="hljs-keyword">on</span>(<span class="hljs-string">'on-do'</span>, <span class="hljs-literal">null</span>)


<span class="hljs-comment">// border2</span>
<span class="hljs-keyword">this</span>.$<span class="hljs-built_in">parent</span>.$emit(<span class="hljs-string">'on-do'</span>)
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="祖先组件与后代之间通信"></a><a href="#祖先组件与后代之间通信" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>祖先组件与后代之间通信</h3>
<h4><a class="anchor" aria-hidden="true" id="provide-依赖注入"></a><a href="#provide-依赖注入" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>provide 依赖注入</h4>
<p>由于使用 <code>$parent</code> 属性无法很好的扩展到更深层级的嵌套组件上</p>
<p>vue提供了新的实例选项：provide 和 inject</p>
<p>父组件</p>
<pre><code class="hljs css language-javascript">provide () {
  <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">anchorCom</span>: <span class="hljs-keyword">this</span>
  };
}
</code></pre>
<p>子组件</p>
<pre><code class="hljs css language-javascript">inject: ['anchorCom']

# 使用
this.anchorCom.xxx
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="传入v-model到组件内部"></a><a href="#传入v-model到组件内部" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>传入v-model到组件内部</h3>
<pre><code class="hljs css language-javascript">props: {
    <span class="hljs-attr">value</span>: {
        <span class="hljs-attr">type</span>: [<span class="hljs-built_in">String</span>, <span class="hljs-built_in">Number</span>],
        <span class="hljs-attr">default</span>: <span class="hljs-string">''</span>
    }
},
data () {
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">currentVal</span>: <span class="hljs-keyword">this</span>.value
    }
},
<span class="hljs-attr">watch</span>: {
    value (val) {
        <span class="hljs-keyword">this</span>.currentVal = val
    }
}
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="任意2个组件之间通信"></a><a href="#任意2个组件之间通信" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>任意2个组件之间通信</h3>
<h4><a class="anchor" aria-hidden="true" id="事件总线-创建一个bus类-负责事件派发-监听和回调"></a><a href="#事件总线-创建一个bus类-负责事件派发-监听和回调" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>事件总线，创建一个bus类，负责事件派发、监听和回调</h4>
<pre><code class="hljs css language-javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Bus</span> </span>{
  <span class="hljs-keyword">constructor</span>() {
    <span class="hljs-comment">// {</span>
    <span class="hljs-comment">//   eventName1:[fn1,fn2],</span>
    <span class="hljs-comment">//   eventName2:[fn3,fn4],</span>
    <span class="hljs-comment">// }</span>
    <span class="hljs-keyword">this</span>.callbacks = {};
  }
  $on(name, fn) {
    <span class="hljs-keyword">this</span>.callbacks[name] = <span class="hljs-keyword">this</span>.callbacks[name] || [];
    <span class="hljs-keyword">this</span>.callbacks[name].push(fn);
  }
  $emit(name, args) {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.callbacks[name]) {
      <span class="hljs-comment">// 存在 遍历所有callback</span>
      <span class="hljs-keyword">this</span>.callbacks[name].forEach(<span class="hljs-function"><span class="hljs-params">cb</span> =&gt;</span> cb(args));
    }
  }
}


Vue.prototype.$bus = <span class="hljs-keyword">new</span> Bus()


<span class="hljs-keyword">this</span>.$bus.$on(<span class="hljs-string">'on-do'</span>, v =&gt; {

})

<span class="hljs-keyword">this</span>.$bus.$emit(<span class="hljs-string">'on-do'</span>, <span class="hljs-literal">null</span>)
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="获取元素布局信息"></a><a href="#获取元素布局信息" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>获取元素布局信息</h3>
<pre><code class="hljs css language-javascript"><span class="hljs-keyword">this</span>.$el.getBoundingClientRect()
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="回到顶部组件"></a><a href="#回到顶部组件" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>回到顶部组件</h3>
<p>当滚动高度大于等于100时， 显示回到顶部按钮</p>
<p><img src="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/pageYOffset" alt="pageYOffset"></p>
<pre><code class="hljs css language-javascript"><span class="hljs-built_in">window</span>.pageYOffset &gt;= <span class="hljs-number">100</span>
</code></pre>
<p>获取<code>window</code>滚动的高度</p>
<pre><code class="hljs css language-javascript"><span class="hljs-built_in">document</span>.documentElement.scrollTop || <span class="hljs-built_in">document</span>.body.scrollTop
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="注入弹窗组件到-body"></a><a href="#注入弹窗组件到-body" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>注入弹窗组件到<code>body</code></h3>
<p>使用</p>
<p><code>Notice</code>是提示组件</p>
<p><code>create</code>方法返回组件实例</p>
<pre><code class="hljs css language-javascript"><span class="hljs-keyword">const</span> comp = create(Notice, {
    <span class="hljs-attr">title</span>: <span class="hljs-string">"社会你杨哥喊你来搬砖"</span>,
    <span class="hljs-attr">message</span>: isValidate ? <span class="hljs-string">"请求登录!"</span> : <span class="hljs-string">"校验失败!"</span>,
    <span class="hljs-attr">duration</span>: <span class="hljs-number">3000</span>
})

comp.show()
</code></pre>
<blockquote>
<p>create.js</p>
</blockquote>
<pre><code class="hljs css language-javascript"><span class="hljs-keyword">import</span> Vue <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">create</span>(<span class="hljs-params">Component, props</span>) </span>{
    <span class="hljs-comment">// 1. 创建Component实例</span>
    <span class="hljs-keyword">const</span> vm = <span class="hljs-keyword">new</span> Vue({
        render(h) {
            <span class="hljs-comment">// 渲染函数使用</span>
            <span class="hljs-comment">// h === createElement</span>
            <span class="hljs-comment">// h(Component) =&gt; vdom</span>
            <span class="hljs-keyword">return</span> h(Component, {props})
        }
    }).$mount() <span class="hljs-comment">// 先渲染不挂载</span>

    <span class="hljs-comment">// 方式2：Vue.extend() 返回组件构造函数</span>
    <span class="hljs-comment">// const Ctor = Vue.extend(Component)</span>
    <span class="hljs-comment">// const comp = new Ctor({propsData: props})    </span>
    <span class="hljs-comment">// document.body.appendChild(comp.$el)</span>

    <span class="hljs-comment">// 获取dom</span>
    <span class="hljs-built_in">document</span>.body.appendChild(vm.$el)

    <span class="hljs-comment">// 2. 挂载</span>
    <span class="hljs-keyword">const</span> comp = vm.$children[<span class="hljs-number">0</span>];

    <span class="hljs-comment">// 3. 销毁</span>
    comp.remove = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
        <span class="hljs-built_in">document</span>.body.removeChild(vm.$el)
        vm.$destroy()
    }

    <span class="hljs-keyword">return</span> comp
}
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="插槽"></a><a href="#插槽" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>插槽</h3>
<h4><a class="anchor" aria-hidden="true" id="具名-匿名"></a><a href="#具名-匿名" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>具名 &amp; 匿名</h4>
<pre><code class="hljs css language-javascript"><span class="hljs-comment">// my-com</span>
&lt;div&gt;
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">slot</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">slot</span>&gt;</span></span>
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">slot</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"title"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">slot</span>&gt;</span></span>
<span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>


<span class="hljs-comment">// 使用</span>
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">my-com</span>&gt;</span>
    // 默认
    <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">v-slot:default</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
    // title槽位
    <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">v-slot:title</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">my-com</span>&gt;</span></span>
</code></pre>
<h4><a class="anchor" aria-hidden="true" id="作用域"></a><a href="#作用域" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>作用域</h4>
<pre><code class="hljs css language-javascript"><span class="hljs-comment">// my-com</span>
&lt;div&gt;
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">slot</span> <span class="hljs-attr">prop1</span>=<span class="hljs-string">"hello world"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">slot</span>&gt;</span></span>
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">slot</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"title"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">slot</span>&gt;</span></span>
<span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>


<span class="hljs-comment">// 使用</span>
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">my-com</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">v-slot:default</span>=<span class="hljs-string">"{prop1}"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>{{prop1}}<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">my-com</span>&gt;</span></span>
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="sync-v-model-区别"></a><a href="#sync-v-model-区别" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>.sync</code>&amp;<code>v-model</code>区别</h3>
<p><code>v-model</code>是语法糖, 多用于表单元素</p>
<pre><code class="hljs css language-javascript">&lt;input v-model=<span class="hljs-string">"username"</span> /&gt;
&lt;!-- 相当于 --&gt;
&lt;input :value="username" @input="usernme=$event" /&gt;
</code></pre>
<p>父组件传的参数，子组件想修改， 使用<code>.sync</code></p>
<pre><code class="hljs css language-javascript">&lt;HelloWorld :value.sync=<span class="hljs-string">"test"</span>/&gt;

test: <span class="hljs-string">'祝大家'</span>
</code></pre>
<p><code>HelloWorld</code></p>
<pre><code class="hljs css language-javascript"><span class="hljs-keyword">this</span>.$emit(<span class="hljs-string">"update:value"</span>, <span class="hljs-string">"国庆快乐"</span>);
</code></pre>
<p>import store from &quot;./store&quot;;</p>
<h3><a class="anchor" aria-hidden="true" id="路由权限-vuex"></a><a href="#路由权限-vuex" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>路由权限 &amp; Vuex</h3>
<p><code>main.js</code></p>
<pre><code class="hljs css language-js"><span class="hljs-keyword">import</span> Vue <span class="hljs-keyword">from</span> <span class="hljs-string">"vue"</span>;
<span class="hljs-keyword">import</span> App <span class="hljs-keyword">from</span> <span class="hljs-string">"./App.vue"</span>;

<span class="hljs-keyword">import</span> router <span class="hljs-keyword">from</span> <span class="hljs-string">"./router"</span>;
<span class="hljs-keyword">import</span> store <span class="hljs-keyword">from</span> <span class="hljs-string">"./store"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'./permission'</span>


<span class="hljs-keyword">new</span> Vue({
  router,
  store,
  <span class="hljs-attr">render</span>: <span class="hljs-function"><span class="hljs-params">h</span> =&gt;</span> h(App),
}).$mount(<span class="hljs-string">"#app"</span>);

</code></pre>
<p><code>permission.js</code></p>
<ul>
<li>如果没登录， 且访问的是白名单路由，过； 其他没登录的，跳转到登录页</li>
<li>如果已登录， 访问的是登陆页 =&gt; 回到首页；</li>
<li>如果已登录，从<code>store</code>里看该用户<code>roles</code>有么有，有 =&gt; 过；  没有， 去获取<code>dispatch(&quot;user/getInfo&quot;)</code>,  获取到后去对比判断校验<code>permission/generateRoutes</code>,  校验成功的追加<code>addRoutes</code>,  最后路由再进来一次<code>next({ ...to })</code></li>
<li></li>
</ul>
<pre><code class="hljs css language-js"><span class="hljs-keyword">import</span> router <span class="hljs-keyword">from</span> <span class="hljs-string">"./router"</span>;
<span class="hljs-keyword">import</span> store <span class="hljs-keyword">from</span> <span class="hljs-string">"./store"</span>;

<span class="hljs-keyword">const</span> whiteList = [<span class="hljs-string">"/login"</span>]; <span class="hljs-comment">// 无需令牌白名单</span>
 
<span class="hljs-comment">// 全局守卫</span>
router.beforeEach(<span class="hljs-keyword">async</span> (to, <span class="hljs-keyword">from</span>, next) =&gt; {
  <span class="hljs-comment">// 获取令牌判断用户是否登录</span>
  <span class="hljs-keyword">const</span> hasToken = localStorage.getItem(<span class="hljs-string">"token"</span>);

  <span class="hljs-comment">// 已登录</span>
  <span class="hljs-keyword">if</span> (hasToken) {
    <span class="hljs-keyword">if</span> (to.path === <span class="hljs-string">"/login"</span>) {
      <span class="hljs-comment">// 若已登录没有必要显示登录页，重定向至首页</span>
      next({ <span class="hljs-attr">path</span>: <span class="hljs-string">"/"</span> });
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// 去其他路由，暂时放过</span>
      <span class="hljs-comment">// 接下来执行用户角色逻辑, todo</span>
      <span class="hljs-keyword">const</span> hasRoles =
        store.state.user.roles &amp;&amp; store.state.user.roles.length &gt; <span class="hljs-number">0</span>;
      <span class="hljs-keyword">if</span> (hasRoles) {
        next();
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">//   请求角色信息</span>
        <span class="hljs-keyword">try</span> {
          <span class="hljs-keyword">const</span> { roles } = <span class="hljs-keyword">await</span> store.dispatch(<span class="hljs-string">"user/getInfo"</span>);

          <span class="hljs-comment">// 动态路由生成，todo</span>
          <span class="hljs-keyword">const</span> accessRoutes = <span class="hljs-keyword">await</span> store.dispatch(
            <span class="hljs-string">"permission/generateRoutes"</span>,
            roles,
          );
          <span class="hljs-comment">//   动态追加到router</span>
          router.addRoutes(accessRoutes);

          <span class="hljs-comment">// 路由在进来一次</span>
          next({ ...to });
        } <span class="hljs-keyword">catch</span> (error) {
          <span class="hljs-comment">// 出错需重置令牌并重新登录（令牌过期、网络错误等原因）</span>
          <span class="hljs-keyword">await</span> store.dispatch(<span class="hljs-string">"user/resetToken"</span>);
          next(<span class="hljs-string">`/login?redirect=<span class="hljs-subst">${to.path}</span>`</span>);
          alert(error || <span class="hljs-string">"未知错误"</span>);
        }
      }
    }
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// 未登录</span>
    <span class="hljs-keyword">if</span> (whiteList.indexOf(to.path) !== <span class="hljs-number">-1</span>) {
      <span class="hljs-comment">// 白名单中路由放过</span>
      next();
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// 重定向至登录页</span>
      next(<span class="hljs-string">`/login?redirect=<span class="hljs-subst">${to.path}</span>`</span>);
    }
  }
});
</code></pre>
<p><code>store.js</code></p>
<ul>
<li>分模块去管理</li>
<li>一个专门管理权限的模块<code>permission</code></li>
<li>一个专门管理用户信息的模块<code>user</code>，包括登录、获取用户全新信息...</li>
</ul>
<pre><code class="hljs css language-js"><span class="hljs-keyword">import</span> Vue <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> Vuex <span class="hljs-keyword">from</span> <span class="hljs-string">'vuex'</span>
<span class="hljs-keyword">import</span> user <span class="hljs-keyword">from</span> <span class="hljs-string">'./modules/user'</span>
<span class="hljs-keyword">import</span> permission <span class="hljs-keyword">from</span> <span class="hljs-string">'./modules/permission'</span>

Vue.use(Vuex)

<span class="hljs-keyword">const</span> store = <span class="hljs-keyword">new</span> Vuex.Store({
  <span class="hljs-attr">modules</span>: {user, permission}
})

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> store
</code></pre>
<p><code>modules/permission.js</code></p>
<ul>
<li>获取到用户权限信息后会进<code>generateRoutes</code>, 拿着该用户的权限信息<code>[&quot;admin&quot;]</code>，所有的权限路由，去对比判断<code>filterAsyncRoutes</code>, 逻辑很简单，定义的路由有<code>meta.roles = ['admin']</code>， 表示这个页面要<code>admin</code>才能访问，获取到的<code>['admin']</code>, 符合条件，过。</li>
</ul>
<pre><code class="hljs css language-js"><span class="hljs-comment">// 1.保存路由表</span>
<span class="hljs-comment">// 2.可以过滤出当前用户可访问的路由表</span>
<span class="hljs-keyword">import</span> { asyncRoutes, constRoutes } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/router"</span>;

<span class="hljs-keyword">const</span> state = {
  <span class="hljs-attr">routes</span>: [], <span class="hljs-comment">// 完整路由表</span>
  addRoutes: [] <span class="hljs-comment">// 用户可访问路由表</span>
};

<span class="hljs-keyword">const</span> mutations = {
  <span class="hljs-attr">SET_ROUTES</span>: <span class="hljs-function">(<span class="hljs-params">state, routes</span>) =&gt;</span> {
    state.addRoutes = routes;
    state.routes = constRoutes.concat(routes);
  }
};

<span class="hljs-keyword">const</span> actions = {
  <span class="hljs-comment">// 路由生成：在得到用户角色后会第一时间调用</span>
  generateRoutes({ commit }, roles) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> {
      <span class="hljs-comment">// 根据角色做过滤处理</span>
      <span class="hljs-keyword">const</span> accessedRoutes = filterAsyncRoutes(asyncRoutes, roles);;
      commit(<span class="hljs-string">"SET_ROUTES"</span>, accessedRoutes);
      resolve(accessedRoutes);
    });
  }
};

<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filterAsyncRoutes</span>(<span class="hljs-params">routes, roles</span>) </span>{
  <span class="hljs-keyword">const</span> res = [];
  routes.forEach(<span class="hljs-function"><span class="hljs-params">route</span> =&gt;</span> {
    <span class="hljs-comment">// 复制一份</span>
    <span class="hljs-keyword">const</span> tmp = { ...route };
    <span class="hljs-comment">// 如果用户有访问权则加入结果路由表</span>
    <span class="hljs-keyword">if</span> (hasPermission(roles, tmp)) {
      <span class="hljs-comment">// 如果存在子路由则递归过滤之</span>
      <span class="hljs-keyword">if</span> (tmp.children) {
        tmp.children = filterAsyncRoutes(tmp.children, roles);
      }
      res.push(tmp);
    }
  });

  <span class="hljs-keyword">return</span> res;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hasPermission</span>(<span class="hljs-params">roles, route</span>) </span>{
  <span class="hljs-comment">// 如果当前路由有roles字段则需判断用户访问权限</span>
  <span class="hljs-keyword">if</span> (route.meta &amp;&amp; route.meta.roles) {
    <span class="hljs-comment">// 若用户拥有的角色中有被包含在待判定路由角色表中的则拥有访问权</span>
    <span class="hljs-keyword">return</span> roles.some(<span class="hljs-function"><span class="hljs-params">role</span> =&gt;</span> route.meta.roles.includes(role));
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// 没有设置roles则无需判定即可访问</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  }
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">namespaced</span>: <span class="hljs-literal">true</span>,
  state,
  mutations,
  actions
};
</code></pre>
<p><code>@/router.js</code></p>
<ul>
<li>提前定义好的路由</li>
</ul>
<pre><code class="hljs css language-js"><span class="hljs-keyword">import</span> Vue <span class="hljs-keyword">from</span> <span class="hljs-string">"vue"</span>;
<span class="hljs-keyword">import</span> Router <span class="hljs-keyword">from</span> <span class="hljs-string">"vue-router"</span>;
<span class="hljs-keyword">import</span> Layout <span class="hljs-keyword">from</span> <span class="hljs-string">'@/layout'</span>; <span class="hljs-comment">// 布局页</span>

Vue.use(Router);

<span class="hljs-comment">// 通用页面：不需要守卫，可直接访问</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> constRoutes = [
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">"/login"</span>,
    <span class="hljs-attr">component</span>: <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">"@/views/Login"</span>),
    <span class="hljs-attr">hidden</span>: <span class="hljs-literal">true</span> <span class="hljs-comment">// 导航菜单忽略该项</span>
  },
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">"/"</span>,
    <span class="hljs-attr">component</span>: Layout,<span class="hljs-comment">// 应用布局</span>
    redirect: <span class="hljs-string">"/home"</span>,
    <span class="hljs-attr">children</span>: [
      {
        <span class="hljs-attr">path</span>: <span class="hljs-string">"home"</span>,
        <span class="hljs-attr">component</span>: <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span>
          <span class="hljs-keyword">import</span>(<span class="hljs-comment">/* webpackChunkName: "home" */</span> <span class="hljs-string">"@/views/Home.vue"</span>),
        <span class="hljs-attr">name</span>: <span class="hljs-string">"home"</span>,
        <span class="hljs-attr">meta</span>: { 
            <span class="hljs-attr">title</span>: <span class="hljs-string">"Home"</span>, <span class="hljs-comment">// 导航菜单项标题</span>
            icon: <span class="hljs-string">"qq"</span> <span class="hljs-comment">// 导航菜单项图标</span>
        }
      }
    ]
  }
];

<span class="hljs-comment">// 权限页面：受保护页面，要求用户登录并拥有访问权限的角色才能访问</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> asyncRoutes = [
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">"/about"</span>,
    <span class="hljs-attr">component</span>: Layout,
    <span class="hljs-attr">redirect</span>: <span class="hljs-string">"/about/index"</span>,    
    <span class="hljs-attr">children</span>: [
      {
        <span class="hljs-attr">path</span>: <span class="hljs-string">"index"</span>,
        <span class="hljs-attr">component</span>: <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span>
          <span class="hljs-keyword">import</span>(<span class="hljs-comment">/* webpackChunkName: "home" */</span> <span class="hljs-string">"@/views/About.vue"</span>),
        <span class="hljs-attr">name</span>: <span class="hljs-string">"about"</span>,
        <span class="hljs-attr">meta</span>: { 
            <span class="hljs-attr">title</span>: <span class="hljs-string">"About"</span>, 
            <span class="hljs-attr">icon</span>: <span class="hljs-string">"qq"</span>,
            <span class="hljs-attr">roles</span>: [<span class="hljs-string">'admin'</span>, <span class="hljs-string">'editor'</span>]
        },
      }
    ]
  }
];

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">new</span> Router({
  <span class="hljs-attr">mode</span>: <span class="hljs-string">"history"</span>,
  <span class="hljs-attr">base</span>: process.env.BASE_URL,
  <span class="hljs-attr">routes</span>: constRoutes
});
</code></pre>
<ul>
<li><p>如果异步获取路由表，思路如下</p></li>
<li><pre><code class="hljs css language-js"><span class="hljs-comment">// 前端组件名和组件映射表</span>
<span class="hljs-keyword">const</span> map = { <span class="hljs-attr">login</span>:<span class="hljs-built_in">require</span>(<span class="hljs-string">'login/index'</span>).default <span class="hljs-comment">// 同步的方式 login:()=&gt;import('login/index') // 异步的方式 }</span>
<span class="hljs-comment">// 服务端返回的map类似于</span>
<span class="hljs-keyword">const</span> serviceMap = [
    { <span class="hljs-attr">path</span>: <span class="hljs-string">'/login'</span>, <span class="hljs-attr">component</span>: <span class="hljs-string">'login'</span>, <span class="hljs-attr">hidden</span>: <span class="hljs-literal">true</span> }
]
<span class="hljs-comment">// 遍历serviceMap，将component替换为map[component]，动态生成asyncRoutes function mapComponent(route) {</span>
route.component = serviceMap[route.component];
<span class="hljs-keyword">if</span>(route.children) {
     route.children = route.children.map(<span class="hljs-function"><span class="hljs-params">child</span> =&gt;</span> mapComponent(child))
 }
 <span class="hljs-keyword">return</span> route
}
</code></pre></li>
</ul>
<p><code>modules/user.js</code></p>
<ul>
<li>用户模块</li>
</ul>
<pre><code class="hljs css language-js"><span class="hljs-comment">// 用户状态：登录态、信息</span>
<span class="hljs-keyword">const</span> state = {
  <span class="hljs-attr">token</span>: localStorage.getItem(<span class="hljs-string">"token"</span>),
  <span class="hljs-comment">// 其他用户信息</span>
  roles: [],
};

<span class="hljs-keyword">const</span> mutations = {
  <span class="hljs-attr">SET_TOKEN</span>: <span class="hljs-function">(<span class="hljs-params">state, token</span>) =&gt;</span> {
    state.token = token;
  },
  <span class="hljs-attr">SET_ROLES</span>: <span class="hljs-function">(<span class="hljs-params">state, roles</span>) =&gt;</span> {
    state.roles = roles;
  },
};

<span class="hljs-keyword">const</span> actions = {
  <span class="hljs-comment">// 模拟用户登录</span>
  login({ commit }, userInfo) {
    <span class="hljs-keyword">const</span> { username } = userInfo;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
      setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
        <span class="hljs-keyword">if</span> (username === <span class="hljs-string">"admin"</span> || username === <span class="hljs-string">"jerry"</span>) {
          commit(<span class="hljs-string">"SET_TOKEN"</span>, username);
          localStorage.setItem(<span class="hljs-string">"token"</span>, username);
          resolve();
        } <span class="hljs-keyword">else</span> {
          reject(<span class="hljs-string">"用户名、密码错误"</span>);
        }
      }, <span class="hljs-number">1000</span>);
    });
  },
  getInfo({ commit, state }) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> {
      setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
        <span class="hljs-keyword">const</span> roles = state.token === <span class="hljs-string">"admin"</span> ? [<span class="hljs-string">"admin"</span>] : [<span class="hljs-string">"editor"</span>];
        commit(<span class="hljs-string">"SET_ROLES"</span>, roles);
        resolve({ roles });
      }, <span class="hljs-number">1000</span>);
    });
  },
  resetToken({ commit }) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> {
      commit(<span class="hljs-string">"SET_TOKEN"</span>, <span class="hljs-string">""</span>);
      commit(<span class="hljs-string">"SET_ROLES"</span>, []);
      localStorage.removeItem(<span class="hljs-string">"token"</span>);
      resolve();
    });
  },
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">namespaced</span>: <span class="hljs-literal">true</span>,
  state,
  mutations,
  actions,
};

</code></pre>
<h3><a class="anchor" aria-hidden="true" id="面包屑"></a><a href="#面包屑" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>面包屑</h3>
<ul>
<li><p>通过 $route.matched 数组动态生成的</p></li>
<li><pre><code class="hljs css language-js">getBreadcrumb() {
  <span class="hljs-built_in">console</span>.log(<span class="hljs-keyword">this</span>.$route.matched);
  <span class="hljs-comment">// 面包屑仅显示包含meta.title且item.meta.breadcrumb不为false的路由 </span>
  <span class="hljs-keyword">let</span> matched = <span class="hljs-keyword">this</span>.$route.matched.filter(
    <span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.meta &amp;&amp; item.meta.title &amp;&amp; item.meta.breadcrumb !== <span class="hljs-literal">false</span>
  );
  <span class="hljs-comment">// 根路由</span>
  <span class="hljs-keyword">const</span> first = matched[<span class="hljs-number">0</span>];
  <span class="hljs-comment">// 根匹配只要不是home，就作为home下一级 </span>
  <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.isHome(first)) {
      matched = [{ <span class="hljs-attr">path</span>: <span class="hljs-string">'/'</span>, <span class="hljs-attr">redirect</span>: <span class="hljs-string">"/home"</span>, <span class="hljs-attr">meta</span>: { <span class="hljs-attr">title</span>: <span class="hljs-string">"首页"</span> } }].concat(matched);
  }
  <span class="hljs-comment">// 处理完指定到levelList</span>
  <span class="hljs-keyword">this</span>.levelList = matched
},
isHome(route) {
  <span class="hljs-keyword">const</span> name = route &amp;&amp; route.name;
  <span class="hljs-keyword">if</span> (!name) {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  }
  <span class="hljs-keyword">return</span> name.trim().toLocaleLowerCase() === <span class="hljs-string">"home"</span>.toLocaleLowerCase();
},
handleLink(item) {
  <span class="hljs-keyword">const</span> { redirect, path } = item; <span class="hljs-comment">// 若存在重定向，按重定向走</span>
  <span class="hljs-keyword">if</span> (redirect) {
    <span class="hljs-keyword">this</span>.$router.push(redirect);
    <span class="hljs-keyword">return</span>; 
  }
  <span class="hljs-comment">// 编译path，避免存在路径参数</span>
  <span class="hljs-keyword">this</span>.$router.push(<span class="hljs-keyword">this</span>.pathCompile(path));
},
pathCompile(path) {
  <span class="hljs-keyword">const</span> { params } = <span class="hljs-keyword">this</span>.$route;
  <span class="hljs-keyword">var</span> toPath = pathToRegexp.compile(path);
  <span class="hljs-keyword">return</span> toPath(params);
}
</code></pre></li>
<li><p><code>template</code></p></li>
<li><pre><code class="hljs css language-html"><span class="hljs-tag">&lt;<span class="hljs-name">el-breadcrumb-item</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"(item,index) in levelList"</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">"item.path"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">span</span>
  <span class="hljs-attr">v-if</span>=<span class="hljs-string">"item.redirect==='noRedirect'||index==levelList.length-1"</span>
  <span class="hljs-attr">class</span>=<span class="hljs-string">"no-redirect"</span>
  &gt;</span>{{ item.meta.title }}<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">v-else</span> @<span class="hljs-attr">click.prevent</span>=<span class="hljs-string">"handleLink(item)"</span>&gt;</span>{{ item.meta.title }}<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">el-breadcrumb-item</span>&gt;</span>
</code></pre></li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="按钮权限"></a><a href="#按钮权限" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>按钮权限</h3>
<pre><code class="hljs css language-js"><span class="hljs-keyword">import</span> store <span class="hljs-keyword">from</span> <span class="hljs-string">"@/store"</span>;
<span class="hljs-comment">// &lt;button v-permision="['admin','editor']"</span>
<span class="hljs-keyword">const</span> permission = {
  inserted(el, binding) {
    <span class="hljs-comment">// 获取指令的值：按钮要求的角色数组</span>
    <span class="hljs-keyword">const</span> { <span class="hljs-attr">value</span>:pRoles } = binding;
    <span class="hljs-comment">// 获取用户角色</span>
    <span class="hljs-keyword">const</span> roles = store.state.user.roles;

    <span class="hljs-keyword">if</span> (pRoles &amp;&amp; pRoles <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Array</span> &amp;&amp; pRoles.length &gt; <span class="hljs-number">0</span>) {      
      <span class="hljs-comment">// 判断用户角色中是否有按钮要求的角色</span>
      <span class="hljs-keyword">const</span> hasPermission = roles.some(<span class="hljs-function"><span class="hljs-params">role</span> =&gt;</span> {
        <span class="hljs-keyword">return</span> pRoles.includes(role);
      });

      <span class="hljs-comment">// 如果没有权限则删除当前dom</span>
      <span class="hljs-keyword">if</span> (!hasPermission) {
        el.parentNode &amp;&amp; el.parentNode.removeChild(el);
      }
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">`需要指定按钮要求角色数组，如v-permission="['admin','editor']"`</span>);
    }
  }
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> permission;

</code></pre>
<h3><a class="anchor" aria-hidden="true" id="封装-request"></a><a href="#封装-request" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>封装<code>request</code></h3>
<pre><code class="hljs css language-js"><span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">"axios"</span>;
<span class="hljs-keyword">import</span> { MessageBox, Message } <span class="hljs-keyword">from</span> <span class="hljs-string">"element-ui"</span>;
<span class="hljs-keyword">import</span> store <span class="hljs-keyword">from</span> <span class="hljs-string">"@/store"</span>;

<span class="hljs-comment">// 创建axios实例</span>
<span class="hljs-keyword">const</span> service = axios.create({
  <span class="hljs-attr">baseURL</span>: process.env.VUE_APP_BASE_API, <span class="hljs-comment">// url基础地址，解决不同数据源url变化问题</span>
  <span class="hljs-comment">// withCredentials: true, // 跨域时若要发送cookies需设置该选项</span>
  timeout: <span class="hljs-number">5000</span> <span class="hljs-comment">// 超时</span>
});

<span class="hljs-comment">// 请求拦截</span>
service.interceptors.request.use(
  <span class="hljs-function"><span class="hljs-params">config</span> =&gt;</span> {
    <span class="hljs-comment">// do something</span>
    <span class="hljs-keyword">const</span> token = localStorage.getItem(<span class="hljs-string">'token'</span>)
    <span class="hljs-keyword">if</span> (token) {
      <span class="hljs-comment">// 设置令牌请求头</span>
      config.headers[<span class="hljs-string">"Authorization"</span>] = <span class="hljs-string">'Bearer '</span> + token;
    }
    <span class="hljs-keyword">return</span> config;
  },
  error =&gt; {
    <span class="hljs-comment">// 请求错误预处理</span>
    <span class="hljs-comment">//console.log(error) // for debug</span>
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Promise</span>.reject(error);
  }
);

<span class="hljs-comment">// 响应拦截</span>
service.interceptors.response.use(
  <span class="hljs-comment">// 通过自定义code判定响应状态，也可以通过HTTP状态码判定</span>
  <span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> {
    <span class="hljs-comment">// 仅返回数据部分</span>
    <span class="hljs-keyword">const</span> res = response.data;

    <span class="hljs-comment">// code不为1则判定为一个错误</span>
    <span class="hljs-keyword">if</span> (res.code !== <span class="hljs-number">1</span>) {
      Message({
        <span class="hljs-attr">message</span>: res.message || <span class="hljs-string">"Error"</span>,
        <span class="hljs-attr">type</span>: <span class="hljs-string">"error"</span>,
        <span class="hljs-attr">duration</span>: <span class="hljs-number">5</span> * <span class="hljs-number">1000</span>
      });

      <span class="hljs-comment">// 假设：10008-非法令牌; 10012-其他客户端已登录; 10014-令牌过期;</span>
      <span class="hljs-keyword">if</span> (res.code === <span class="hljs-number">10008</span> || res.code === <span class="hljs-number">10012</span> || res.code === <span class="hljs-number">10014</span>) {
        <span class="hljs-comment">// 重新登录</span>
        MessageBox.confirm(
          <span class="hljs-string">"登录状态异常，请重新登录"</span>,
          <span class="hljs-string">"确认登录信息"</span>,
          {
            <span class="hljs-attr">confirmButtonText</span>: <span class="hljs-string">"重新登录"</span>,
            <span class="hljs-attr">cancelButtonText</span>: <span class="hljs-string">"取消"</span>,
            <span class="hljs-attr">type</span>: <span class="hljs-string">"warning"</span>
          }
        ).then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
          store.dispatch(<span class="hljs-string">"user/resetToken"</span>).then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
            location.reload();
          });
        });
      }
      <span class="hljs-keyword">return</span> <span class="hljs-built_in">Promise</span>.reject(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(res.message || <span class="hljs-string">"Error"</span>));
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">return</span> res;
    }
  },
  error =&gt; {
    <span class="hljs-comment">//console.log("err" + error); // for debug</span>
    Message({
      <span class="hljs-attr">message</span>: error.message,
      <span class="hljs-attr">type</span>: <span class="hljs-string">"error"</span>,
      <span class="hljs-attr">duration</span>: <span class="hljs-number">5</span> * <span class="hljs-number">1000</span>
    });
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Promise</span>.reject(error);
  }
);

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> service;

</code></pre>
<h3><a class="anchor" aria-hidden="true" id="代理配置"></a><a href="#代理配置" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>代理配置</h3>
<p><code>vue.config.js</code></p>
<pre><code class="hljs css language-js">devServer: {
    <span class="hljs-attr">port</span>: port,
    <span class="hljs-attr">proxy</span>: {
    <span class="hljs-comment">// 代理 /dev-api/user/login 到 http://127.0.0.1:3000/user/login [process.env.VUE_APP_BASE_API]: {</span>
      target: <span class="hljs-string">`http://127.0.0.1:3000/`</span>,
      <span class="hljs-attr">changeOrigin</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">pathRewrite</span>: {
            [<span class="hljs-string">"^"</span> + process.env.VUE_APP_BASE_API]: <span class="hljs-string">""</span>
      }
    }},
}
</code></pre>
<p><code>.env.development</code></p>
<pre><code class="hljs"><span class="hljs-meta"># base api</span>
<span class="hljs-meta"># VUE_APP_BASE_API = '/dev-api'</span>
VUE_APP_BASE_API = 'http://127.0.0.1:<span class="hljs-number">7300</span>/mock/5d786f7c8d7eac40b82e<span class="hljs-number">9538</span>/vue-study'
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="测试"></a><a href="#测试" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>测试</h3>
<ul>
<li>不管内部实现机制，只看最外层的输入输出，这种我们称为<strong>黑 盒测试</strong></li>
<li>写一个加法的页面，会设计N个用例，测试加法的正确性，这种测试我们称之为<strong>E2E****测 试</strong></li>
<li>针对一些内部核心实现逻辑编写测试代码，称之为<strong>单元测试</strong></li>
<li>集合多个测试过的单元一起测试，称之为<strong>集成测试</strong></li>
<li><strong>编写测试代码的好处</strong>
<ul>
<li>提供描述组件行为的文档</li>
<li>节省手动测试的时间</li>
<li>减少研发新特性时产生的 bug改进设计</li>
<li>促进重构</li>
</ul></li>
</ul>
<h4><a class="anchor" aria-hidden="true" id="mocha-chai"></a><a href="#mocha-chai" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>Mocha +Chai</code></h4>
<ul>
<li><p>在vue中，推荐用<strong>Mocha+Chai</strong>或者Jest，演示代码使用Jest，它们语法基本一致</p></li>
<li><p>上面的Mocha是测试框架，Chai是断言库，Jest同时包含两者</p></li>
<li><p>vue中的组件等测试代码的编写需要vue-test-utils套件支持</p></li>
<li><p><strong>新建****vue项目时</strong>：</p>
<ul>
<li>选择特性 Unit Testing 和 E2E Testing</li>
<li>单元测试解决方案选择: Jest</li>
<li>端到端测试解决方案选择:Cypress</li>
</ul></li>
<li><p><strong>在已存在项目中集成</strong></p>
<ul>
<li>运行: vue add @vue/unit-jest 和 vue add @vue/e2e-cypress</li>
</ul></li>
<li><p><strong>编写单元测试</strong></p>
<ul>
<li><p>单元测试(unit testing)，是指对软件中的最小可测试单元进行检查和验证。</p></li>
<li><p>新建test/unit/kaikeba.spec.js， *.spec.js 是命名规范</p></li>
<li><pre><code class="hljs css language-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">add</span>(<span class="hljs-params">num1, num2</span>) </span>{
    <span class="hljs-keyword">return</span> num1 + num2
}
<span class="hljs-comment">// 测试套件 test suite </span>
describe(<span class="hljs-string">'testA'</span>, () =&gt; {
<span class="hljs-comment">// 测试用例 test case </span>
  it(<span class="hljs-string">'测试add函数'</span>, () =&gt; {
    <span class="hljs-comment">// 断言 assert </span>
        expect(add(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>)).toBe(<span class="hljs-number">3</span>) 
    expect(add(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>)).toBe(<span class="hljs-number">4</span>) 
    expect(add(<span class="hljs-number">-2</span>, <span class="hljs-number">3</span>)).toBe(<span class="hljs-number">1</span>)
  }) 
})
</code></pre></li>
</ul></li>
<li><p><strong>执行单元测试</strong></p>
<ul>
<li>执行: <code>npm run test:unit</code></li>
</ul></li>
<li><p><strong>断言****API****简介</strong></p>
<ul>
<li>describe : 定义一个测试套件</li>
<li>it :定义一个测试用例</li>
<li>expect :断言的判断条件</li>
</ul></li>
<li><p><strong>测试****Vue****组件</strong></p>
<ul>
<li><p>vue官方提供了用于单元测试的实用工具库 @vue/test-utils</p></li>
<li><p>创建一个vue组件components/testA.vue</p></li>
<li><pre><code class="hljs css language-js">&lt;template&gt;
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>{{ message }}<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"changeMsg"</span>&gt;</span>点击<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
<span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span>
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
  <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
    data () {
      <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">message</span>: <span class="hljs-string">'vue-text'</span>
            } 
    },
    created () { 
      <span class="hljs-keyword">this</span>.message = <span class="hljs-string">'a'</span>
    }, 
    <span class="hljs-attr">methods</span>:{
      changeMsg(){
        <span class="hljs-keyword">this</span>.message = <span class="hljs-string">'按钮点击'</span>
      } 
    }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre></li>
<li><p>测试该组件，test/unit/testA.spec.js</p></li>
<li><pre><code class="hljs css language-js"><span class="hljs-keyword">import</span> testA <span class="hljs-keyword">from</span> <span class="hljs-string">'@/components/testA.vue'</span>
describe(<span class="hljs-string">'testA.vue'</span>, () =&gt; {
    <span class="hljs-comment">// 检查组件选项 </span>
  it(<span class="hljs-string">'要求设置created生命周期'</span>, () =&gt; {
    expect(<span class="hljs-keyword">typeof</span> testA.created).toBe(<span class="hljs-string">'function'</span>)
  })
    it(<span class="hljs-string">'message初始值是vue-test'</span>, () =&gt; {
        <span class="hljs-comment">// 检查data函数存在性</span>
        expect(<span class="hljs-keyword">typeof</span> testA.data).toBe(<span class="hljs-string">'function'</span>) <span class="hljs-comment">// 检查data返回的默认值</span>
    <span class="hljs-keyword">const</span> defaultData = testA.data()
    expect(defaultData.message).toBe(<span class="hljs-string">'vue-test'</span>)
  })
})
</code></pre></li>
</ul></li>
<li><p><strong>测试覆盖率</strong></p>
<ul>
<li><p>jest自带覆盖率，如果用的mocha，需要使用istanbul来统计覆盖率</p></li>
<li><p>package.json里修改jest配置</p></li>
<li><pre><code class="hljs css language-js"><span class="hljs-string">"jest"</span>: {
    <span class="hljs-string">"collectCoverage"</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-string">"collectCoverageFrom"</span>: [<span class="hljs-string">"src/**/*.{js,vue}"</span>],
}
</code></pre></li>
</ul></li>
<li><p><a href="https://vue-test-utils.vuejs.org/zh/">Vue Test Utils使用指南</a></p></li>
<li><p><a href="https://cn.vuejs.org/v2/cookbook/unit-testing-vue-components.html">Vue组件单元测试cookbook</a></p></li>
<li><p><a href="https://jestjs.io/docs/zh-Hans/expect">断言API</a></p></li>
<li><p><strong>E2E****测试</strong></p>
<ul>
<li><p>借用浏览器的能力，站在用户测试人员的角度，输入框，点击按钮等，完全模拟用户，这个和具体的框
架关系不大，完全模拟浏览器行为</p></li>
<li><p><strong>运行****E2E****测试</strong></p></li>
<li><pre><code class="hljs css language-js">npm run test:e2e
</code></pre></li>
<li><p>修改e2e/spec/test.js</p></li>
<li><pre><code class="hljs css language-js">describe(<span class="hljs-string">'端到端测试'</span>, () =&gt; { 
    it(<span class="hljs-string">'先访问一下'</span>, () =&gt; {
        cy.visit(<span class="hljs-string">'/'</span>)
        <span class="hljs-comment">// cy.contains('h1', 'Welcome to Your Vue.js App') </span>
        cy.contains(<span class="hljs-string">'span'</span>, <span class="hljs-string">'hello'</span>)
        cy.get(<span class="hljs-string">'button'</span>).click()
        cy.contains(<span class="hljs-string">'span'</span>, <span class="hljs-string">'按钮点击'</span>)
    }) 
})
</code></pre></li>
</ul></li>
</ul>
</span></div></div><div class="blogSocialSection"></div></div><div class="blog-recent"><a class="button" href="/liuxiaobai/blog">Recent Posts</a></div></div></div><nav class="onPageNav"></nav></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: 'my-api-key',
                indexName: 'my-index-name',
                inputSelector: '#search_input_react',
                algoliaOptions: {}
              });
            </script></body></html>